# Forklift Desirer - High-Fidelity Container Loading System

Forklift Desirer is a 3D container loading visualization and planning system based on React + Three.js. It is not just a spatial stacking tool, but an intelligent decision-making system deeply integrated with **Real-world Logistics Constraints**.

The system supports **Local AI (Ollama)**, ensuring data privacy while providing intelligent packing list recognition and recommendations.

## Core Simulation & Operational Logic (Real-world Feasibility)

To ensure that the generated loading plans are 100% executable at docks and warehouses, we enforce strict physical constraints:

### 1. Skilled Forklift Operation Simulation
*   **Logic**: In reality, skilled forklift operators can use a Side Shifter and angled entry to push cargo into tight spaces.
*   **Constraints**: The algorithm simulates the physical collision volume of a standard 1.1-meter wide forklift but introduces a **50cm Side Shift capability** and minimal wall clearance (2cm Wall Buffer). This means the system can achieve high-density loading (Squeezing boxes in) without violating physical laws.
*   **Optimization**: v0.1.0 introduces a **Spatial Grid** collision detection system, enabling instant calculation (O(N) performance) even with 2000+ objects.

### 2. Cargo Group Affinity
*   **Logic**: To facilitate transport reinforcement (e.g., dunnage) and unloading, goods of the same type should be grouped together rather than scattered across the container.
*   **Constraints**: The packing algorithm includes a "Loose Adhesion" mechanismâ€”strict adhesion at the bottom layer, while the upper layers allow for moderate mixing to optimize fill rates without wasting space, balancing stability and efficiency.

### 3. Physical Access Path & Obstacles
*   **Logic**: Cargo must be pushable from the container door to its target position without obstacles in the path.
*   **Constraints**: The system calculates the swept path of the forklift chassis and forks in real-time. If the path is blocked by previously placed cargo, that position is deemed unreachable.

### 4. Sequential Operation
*   **Logic**: Simulates the continuous operation of a single forklift.
*   **Visualization**: 3D animation demonstrates the complete process from entry, lifting, side-shifting, placement to exit, including fork lifting actions to avoid lower-layer cargo.

## 3D Manual Mode

Forklift Desirer offers a powerful manual fine-tuning mode that supports interaction based on a physics engine.

*   **Drag & Drop**: Click and drag cargo with the left mouse button to move it within the container.
    *   **Physics Stacking**: When cargo is dragged over other items, it automatically "climbs" and stacks on top. The system detects collisions in real-time to prevent clipping.
    *   **Global Snapping**: Cargo automatically snaps to container walls or edges of other adjacent items (supports cross-container snapping) for alignment.
*   **Selection**:
    *   **Single Select**: Click on an item to select it.
    *   **Multi-Select**: Hold `Ctrl` (Windows) or `Cmd` (Mac) and click items to add/remove from selection.
    *   **Box Select**: Hold `Shift` and drag the mouse (even if starting on an item) to draw a selection box for batch selection.
    *   **Deselect**: Click on empty space.
*   **Camera Controls**:
    *   **Rotate**: Hold Middle Mouse Button and drag / Left drag on empty space (when nothing is selected).
    *   **Pan**: Hold Right Mouse Button and drag.
    *   **Zoom**: Scroll Mouse Wheel.
*   **Info Tooltip**: Hover the mouse over a container for **3 seconds** to display detailed statistics (Volume, Weight, Cargo Manifest).
    *   **Copy Info**: Press `Ctrl+C` while the tooltip is visible to copy the complete manifest to the clipboard.
    *   **Undo**: Press `Ctrl+Z` to undo the last move operation.

## Intelligent AI Integration (Local AI Native)

The system's AI service layer has been completely refactored to prioritize local operation and introduce more precise data interaction modes:

*   **Dual-Mode Intelligence**: The system automatically identifies user intent. If input contains cargo data, it switches to **Data Extraction Mode** for strict JSON formatting; if the user asks logistics questions, it switches to **Advisor Mode**.
*   **External LLM Support**:
    *   **Copy System Prompt**: For users without a powerful local model or API, we provide a one-click "Copy System Prompt" feature. You can send this prompt to external models like ChatGPT/Claude.
    *   **Manual Import**: Supports pasting JSON generated by external models back into the system to instantly generate visualization plans.
*   **Local AI (Ollama)**: Default support for connecting to a local Ollama service (auto-detects models like `llama3`, `qwen`, etc.). No data upload risk, zero API cost.
*   **OpenAI Compatible**: Supports any cloud or local service compatible with the OpenAI interface (e.g., LM Studio).
*   **Functions**: AI is used for natural language processing, including parsing messy packing list text, converting unit dimensions, extracting cargo metadata, etc.
*   **Image Recognition (New)**: Directly **drag and drop packing list images** into the AI chat box to automatically recognize and extract cargo information (requires a multimodal-supported model).

## Tech Stack

*   **Frontend**: React, Vite, TypeScript
*   **3D Engine**: Three.js, @react-three/fiber, @react-three/drei
*   **Desktop Shell**: Electron
*   **Algorithm**: Heuristic 3D Bin Packing with Constraints, Optimized Spatial Grid (O(N) Complexity)
*   **State Management**: React Hooks + Context
*   **Styling**: Tailwind CSS

## Quick Start

### Download & Install (Release)
We recommend downloading the compiled executable directly without configuring a development environment:
1. Go to the `release/` directory (or GitHub Releases page).
2. Download `Forklift Desirer Setup.exe`.
3. Install and run.

### Development Environment
If you want to modify the code or contribute:
*   Node.js (v18+)
*   Ollama (Optional, for local AI features)

### Install & Run

1.  **Clone Project**
    ```bash
    git clone <repo_url>
    cd Forklift-Desirer
    ```

2.  **Install Dependencies**
    ```bash
    npm install
    ```

3.  **Start Development Server**
    ```bash
    npm run dev
    ```
    Visit `http://localhost:5173` to use. The system runs entirely locally (Localhost Only) without external network connections.

4.  **Start Local AI (Optional)**
    Ensure Ollama is installed and running (default listening on `localhost:11434`):
    ```bash
    ollama serve
    # And switch Model Provider to Local (Ollama) in settings
    ```

## Usage Tips

1.  **Add Cargo**: Manually enter or paste packing list text via the AI chat window.
2.  **3D Interaction**:
    *   Left click to rotate, Right click to pan, Wheel to zoom.
    *   **Edges**: Edge display is enabled to clearly distinguish stacked cargo.
3.  **Settings & Tuning**:
    *   Click the settings icon in the top right to configure AI models.
    *   Adjust container dimensions to fit different types (20GP, 40HQ, etc.).
