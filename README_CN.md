# Forklift Desirer - 高保真集装箱装载优化系统

**Forklift Desirer** 是一个基于 **React + Three.js** 的 3D 集装箱装载可视化与规划系统。它不仅仅是一个简单的空间堆叠工具，更是一个深度集成**真实物流约束**的智能决策支持系统。

本系统支持 **Local AI (Ollama)**，在提供智能装箱单识别与建议的同时，确保数据隐私安全。

## 核心仿真与操作逻辑 (真实物理可行性)

为了确保生成的装载计划在码头和仓库中 100% 可执行，我们实施了严格的物理约束：

### 1. 熟练叉车操作仿真
*   **逻辑**：现实中，熟练的叉车操作员可以使用侧移器（Side Shifter）和斜角通过技巧将货物推入狭窄空间。
*   **约束**：算法模拟了标准 1.1 米宽叉车的碰撞体积，但引入了 **50cm 侧移能力** 和极小的 **2cm 墙壁缓冲**。这意味着系统可以在不违反物理定律的情况下实现高密度装载（"挤箱子"）。
*   **优化**：v0.1.0 引入了 **Spatial Grid（空间网格）** 碰撞检测系统，即使处理 2000+ 个物体也能实现瞬时计算 (O(N) 性能)。

### 2. 货物分组亲和性 (Cargo Group Affinity)
*   **逻辑**：为了便于加固（如三角木楔）和卸货，同类货物应尽量集中，而不是散落在集装箱各处。
*   **约束**：装箱算法包含“松散粘连”机制——底层严格粘连，上层允许适度混合，以平衡稳定性与装载率。

### 3. 物理路径与障碍物检测
*   **逻辑**：货物必须能够从集装箱门无障碍地运送到目标位置。
*   **约束**：系统实时计算叉车底盘和货叉的扫掠路径。如果路径被先前放置的货物阻挡，该位置将被视为不可达。

### 4. 时序操作与可视化
*   **逻辑**：模拟单台叉车的连续作业流程。
*   **可视化**：全 3D 动画展示从进入、举升、侧移、放置到退出的完整过程，包括为避开下层货物而进行的货叉抬升动作。

## 3D 手动操作模式 (Manual Mode)

Forklift Desirer 提供了强大的手动微调模式，支持基于物理引擎的交互操作。

*   **拖拽移动 (Drag & Drop)**：左键点击并拖拽货物，可以在集装箱内移动。
    *   **物理堆叠 (Physics Stacking)**：当货物被拖拽到其他货物上方时，会自动"爬升"并堆叠在上方。系统实时检测碰撞，防止穿模。
    *   **全局吸附 (Global Snapping)**：货物会自动吸附到集装箱壁或其他相邻货物的边缘（支持跨集装箱吸附），确保对齐。
*   **选择操作 (Selection)**：
    *   **单选**：点击货物即可选中。
    *   **多选**：按住 `Ctrl` (Windows) 或 `Cmd` (Mac) 并点击货物，进行加选/减选。
    *   **框选**：按住 `Shift` 并拖动鼠标（即使起始点在货物上），可画出选择框进行批量选择。
    *   **取消选择**：点击空白处。
*   **视角控制 (Camera Controls)**：
    *   **旋转**：按住中键拖动 / 无选中货物时左键拖动空白处。
    *   **平移**：按住右键拖动。
    *   **缩放**：滚动鼠标滚轮。
*   **信息悬浮窗 (Info Tooltip)**：将鼠标悬停在集装箱上方 **3秒**，即可显示详细统计信息（体积、重量、货物清单）。
    *   **复制信息**：在悬浮窗显示时按下 `Ctrl+C` 可将完整清单复制到剪贴板。
    *   **撤销操作**：按下 `Ctrl+Z` 即可撤销上一次的移动操作。

## 原生本地 AI 集成 (Native Local AI)

AI 服务层经过重构，优先支持本地化运行，并实现了更精准的数据交互：

*   **双模式智能判定**：自动识别用户意图。如果是货物数据输入，切换至**数据提取模式**（严格 JSON 格式）；如果是物流咨询，切换至**专家顾问模式**。
*   **外部 LLM 支持**：
    *   **复制定义 (Copy Prompt)**：为没有本地模型的用户提供一键复制 System Prompt 功能，可配合 ChatGPT/Claude 使用。
    *   **手动导入**：直接粘贴外部模型生成的 JSON 代码，立刻生成可视化方案。
*   **Local AI (Ollama)**：支持连接本地 Ollama 服务（如 `llama3`, `qwen`）。无数据上传风险，零 API 成本。
*   **OpenAI 兼容**：支持任何兼容 OpenAI 接口的云端或本地服务（如 LM Studio）。
*   **视觉识别**：直接将装箱单图片拖入对话框，即可自动提取文本/表格数据（需多模态模型支持）。

## 技术栈 (Tech Stack)

*   **Frontend**: React, Vite, TypeScript
*   **3D Engine**: Three.js, @react-three/fiber, @react-three/drei
*   **Desktop Shell**: Electron
*   **Algorithm**: 带有物理约束的启发式 3D 装箱算法, 优化 Spatial Grid (O(N))
*   **State Management**: React Hooks + Context
*   **Styling**: Tailwind CSS

## 快速开始 (Quick Start)

1.  **克隆与安装**:
    ```bash
    git clone https://github.com/your-repo/Forklift-Desirer.git
    cd Forklift-Desirer
    npm install
    ```
2.  **开发模式**:
    ```bash
    npm run dev
    # 或运行 Electron 版本
    npm run electron:dev
    ```
3.  **构建发布**:
    ```bash
    npm run build
    ```

## 许可证 (License)

MIT
